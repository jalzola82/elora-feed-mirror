name: Mirror external RSS to GitHub

on:
  schedule: [{ cron: "*/30 * * * *" }]
  workflow_dispatch:
  push:
    paths: [".github/workflows/mirror.yml"]

permissions:
  contents: write

concurrency:
  group: mirror-feed
  cancel-in-progress: false

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Configure git
        run: |
          git config user.name "feed-bot"
          git config user.email "feed-bot@users.noreply.github.com"
          git config pull.rebase true
          git checkout main
          git pull --rebase --autostash origin main

      - name: Fetch RSS into site root
        run: |
          curl -sL "https://testelorainfo.blogspot.com/feeds/posts/default?alt=rss" \
            -A "FeedMirror/1.0 (+https://github.com/${{ github.repository }})" \
            -o feed.xml

      - name: Commit if changed
        run: |
          git add .nojekyll feed.xml
          git commit -m "Update feed.xml" || echo "No changes"

      - name: Push
        run: |
          git push origin HEAD:main
